<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eat.today.post.query.mapper.PostMapper">

    <!-- Í∏∞Ï°¥: Ïà† Ï†ÑÏ≤¥ Ï°∞Ìöå -->
    <select id="selectAlcoholList" resultType="com.eat.today.post.query.dto.AlcoholDTO">
        SELECT
        alcohol_no      AS alcohol_no,
        alcohol_type    AS alcohol_type,
        alcohol_explain AS alcohol_explain,
        alcohol_picture AS alcohol_picture
        FROM alcohol
        ORDER BY alcohol_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- alcohol: ÏÑ§Î™Ö/ÏÇ¨ÏßÑÎßå -->
    <select id="selectAlcoholExplainAndPicture" resultType="com.eat.today.post.query.dto.AlcoholSimpleDTO">
        SELECT
        alcohol_explain AS alcohol_explain,
        alcohol_picture AS alcohol_picture
        FROM alcohol
        ORDER BY alcohol_no DESC
    </select>

    <select id="countApprovedFoodsByAlcohol" resultType="long">
        SELECT COUNT(*)
        FROM food_post
        WHERE alcohol_no = #{alcoholNo}
        AND confirmed_yn = 'T'
    </select>

    <!-- ÏÉÅÏÑ∏: Îã®Í±¥ Ï°∞Ìöå -->
    <select id="findFoodById" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        f.board_no      AS boardNo,
        f.alcohol_no    AS alcoholNo,
        f.member_no     AS memberNo,
        m.member_id     AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        f.board_title   AS boardTitle,
        f.board_content AS boardContent,
        f.food_explain  AS foodExplain,
        f.food_picture  AS foodPicture,
        f.board_date    AS boardDate,
        f.board_seq     AS boardSeq,
        f.confirmed_yn  AS confirmedYn,
        f.likes_no_1    AS likesNo1,
        f.likes_no_2    AS likesNo2,
        f.likes_no_3    AS likesNo3,
        f.likes_no_4    AS likesNo4,
        (f.likes_no_1 + f.likes_no_2 + f.likes_no_3 + f.likes_no_4) AS totalLikes,
        COUNT(c.board_no) AS commentCount
        FROM food_post f
        LEFT JOIN food_comment c ON c.board_no = f.board_no
        LEFT JOIN member m ON m.member_no = f.member_no
        WHERE f.board_no = #{boardNo}
        GROUP BY
        f.board_no, f.alcohol_no, f.member_no, m.member_id, m.profile_image_url,
        f.board_title, f.board_content, f.food_explain, f.food_picture,
        f.board_date, f.board_seq, f.confirmed_yn, f.likes_no_1, f.likes_no_2, f.likes_no_3, f.likes_no_4
    </select>

    <!-- Ï°∞ÌöåÏàú -->
    <select id="selectFoodsOrderByViews" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        f.board_no      AS boardNo,
        f.alcohol_no    AS alcoholNo,
        f.member_no     AS memberNo,
        m.member_id     AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        f.board_title   AS boardTitle,
        f.board_content AS boardContent,
        f.food_explain  AS foodExplain,
        f.food_picture  AS foodPicture,
        f.board_date    AS boardDate,
        f.board_seq     AS boardSeq,
        f.confirmed_yn  AS confirmedYn,
        f.likes_no_1    AS likesNo1,
        f.likes_no_2    AS likesNo2,
        f.likes_no_3    AS likesNo3,
        f.likes_no_4    AS likesNo4,
        (f.likes_no_1 + f.likes_no_2 + f.likes_no_3 + f.likes_no_4) AS totalLikes,
        COUNT(c.board_no) AS commentCount
        FROM food_post f
        LEFT JOIN food_comment c ON c.board_no = f.board_no
        LEFT JOIN member m ON m.member_no = f.member_no
        WHERE f.confirmed_yn = 'T'
        GROUP BY f.board_no
        ORDER BY f.board_seq DESC, f.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ÎåìÍ∏ÄÏàú -->
    <select id="selectFoodsOrderByComments" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        f.board_no      AS boardNo,
        f.alcohol_no    AS alcoholNo,
        f.member_no     AS memberNo,
        m.member_id     AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        f.board_title   AS boardTitle,
        f.board_content AS boardContent,
        f.food_explain  AS foodExplain,
        f.food_picture  AS foodPicture,
        f.board_date    AS boardDate,
        f.board_seq     AS boardSeq,
        f.confirmed_yn  AS confirmedYn,
        f.likes_no_1    AS likesNo1,
        f.likes_no_2    AS likesNo2,
        f.likes_no_3    AS likesNo3,
        f.likes_no_4    AS likesNo4,
        (f.likes_no_1 + f.likes_no_2 + f.likes_no_3 + f.likes_no_4) AS totalLikes,
        COUNT(c.board_no) AS commentCount
        FROM food_post f
        LEFT JOIN food_comment c ON c.board_no = f.board_no
        LEFT JOIN member m ON m.member_no = f.member_no
        WHERE f.confirmed_yn = 'T'
        GROUP BY f.board_no
        ORDER BY commentCount DESC, f.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- Î∞òÏùëÏàú -->
    <select id="selectFoodsOrderByTotalLikes" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        f.board_no      AS boardNo,
        f.alcohol_no    AS alcoholNo,
        f.member_no     AS memberNo,
        m.member_id     AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        f.board_title   AS boardTitle,
        f.board_content AS boardContent,
        f.food_explain  AS foodExplain,
        f.food_picture  AS foodPicture,
        f.board_date    AS boardDate,
        f.board_seq     AS boardSeq,
        f.confirmed_yn  AS confirmedYn,
        f.likes_no_1    AS likesNo1,
        f.likes_no_2    AS likesNo2,
        f.likes_no_3    AS likesNo3,
        f.likes_no_4    AS likesNo4,
        (f.likes_no_1 + f.likes_no_2 + f.likes_no_3 + f.likes_no_4) AS totalLikes,
        COUNT(c.board_no) AS commentCount
        FROM food_post f
        LEFT JOIN food_comment c ON c.board_no = f.board_no
        LEFT JOIN member m ON m.member_no = f.member_no
        WHERE f.confirmed_yn = 'T'
        GROUP BY f.board_no
        ORDER BY totalLikes DESC, f.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ÏäπÏù∏Îêú ÏïàÏ£º Î™©Î°ù (Ï£ºÏ¢ÖÎ≥Ñ) -->
    <select id="selectApprovedFoodsByAlcohol" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        fp.board_no      AS boardNo,
        fp.alcohol_no    AS alcoholNo,
        fp.board_title   AS boardTitle,
        fp.board_content AS boardContent,
        fp.food_explain  AS foodExplain,
        m.member_id      AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        fp.food_picture  AS foodPicture,
        fp.board_date    AS boardDate,
        fp.board_seq     AS boardSeq,
        fp.confirmed_yn  AS confirmedYn,
        fp.likes_no_1    AS likesNo1,
        fp.likes_no_2    AS likesNo2,
        fp.likes_no_3    AS likesNo3,
        fp.likes_no_4    AS likesNo4,
        (fp.likes_no_1 + fp.likes_no_2 + fp.likes_no_3 + fp.likes_no_4) AS totalLikes,
        (SELECT COUNT(*) FROM food_comment c WHERE c.board_no = fp.board_no) AS commentCount
        FROM food_post fp
        LEFT JOIN member m ON m.member_no = fp.member_no
        WHERE fp.alcohol_no = #{alcoholNo}
        AND fp.confirmed_yn = 'T'
        ORDER BY fp.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ÏäπÏù∏ Ïó¨Î∂Ä Î¨¥Í¥Ä Ï†ÑÏ≤¥ Î™©Î°ù -->
    <select id="selectAllFoodList" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        fp.board_no      AS boardNo,
        fp.alcohol_no    AS alcoholNo,
        fp.board_title   AS boardTitle,
        fp.board_content AS boardContent,
        fp.food_explain  AS foodExplain,
        m.member_id      AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        fp.food_picture  AS foodPicture,
        fp.board_date    AS boardDate,
        fp.board_seq     AS boardSeq,
        fp.confirmed_yn  AS confirmedYn,
        fp.likes_no_1    AS likesNo1,
        fp.likes_no_2    AS likesNo2,
        fp.likes_no_3    AS likesNo3,
        fp.likes_no_4    AS likesNo4,
        (fp.likes_no_1 + fp.likes_no_2 + fp.likes_no_3 + fp.likes_no_4) AS totalLikes,
        (SELECT COUNT(*) FROM food_comment c WHERE c.board_no = fp.board_no) AS commentCount
        FROM food_post fp
        LEFT JOIN member m ON m.member_no = fp.member_no
        ORDER BY fp.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ÎØ∏ÏäπÏù∏ Î™©Î°ù -->
    <select id="selectUnapprovedFoodList" resultType="com.eat.today.post.query.dto.FoodDTO">
        SELECT
        fp.board_no      AS boardNo,
        fp.alcohol_no    AS alcoholNo,
        fp.board_title   AS boardTitle,
        fp.board_content AS boardContent,
        fp.food_explain  AS foodExplain,
        m.member_id      AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        fp.food_picture  AS foodPicture,
        fp.board_date    AS boardDate,
        fp.board_seq     AS boardSeq,
        fp.confirmed_yn  AS confirmedYn,
        fp.likes_no_1    AS likesNo1,
        fp.likes_no_2    AS likesNo2,
        fp.likes_no_3    AS likesNo3,
        fp.likes_no_4    AS likesNo4,
        (fp.likes_no_1 + fp.likes_no_2 + fp.likes_no_3 + fp.likes_no_4) AS totalLikes,
        (SELECT COUNT(*) FROM food_comment c WHERE c.board_no = fp.board_no) AS commentCount
        FROM food_post fp
        LEFT JOIN member m ON m.member_no = fp.member_no
        WHERE fp.confirmed_yn = 'F'
        ORDER BY fp.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- ÎÇ¥Í∞Ä Ïì¥ Í≤åÏãúÍ∏Ä(ÌöåÏõêÎ≥Ñ, ÏµúÏã†Ïàú) -->
    <select id="selectMyFoods" resultType="com.eat.today.post.query.dto.MyFoodDTO">
        SELECT
        fp.board_no      AS boardNo,
        fp.alcohol_no    AS alcoholNo,
        fp.board_title   AS boardTitle,
        fp.board_content AS boardContent,
        fp.food_explain  AS foodExplain,
        m.member_id      AS memberId,
        m.profile_image_url AS profileImageUrl,   <!-- üëà Ï∂îÍ∞Ä -->
        fp.food_picture  AS foodPicture,
        fp.board_date    AS boardDate,
        fp.board_seq     AS boardSeq,
        fp.likes_no_1    AS likesNo1,
        fp.likes_no_2    AS likesNo2,
        fp.likes_no_3    AS likesNo3,
        fp.likes_no_4    AS likesNo4,
        fp.confirmed_yn  AS confirmedYn
        FROM food_post fp
        JOIN member m ON m.member_no = fp.member_no
        WHERE fp.member_no = #{memberNo}
        ORDER BY fp.board_no DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- Ïù∏Í∏∞ Í≤åÏãúÍ∏Ä TOP N -->
    <select id="selectPopularFoods" resultType="com.eat.today.post.query.dto.PopularFoodDTO">
        SELECT
        fp.board_no     AS board_no,
        fp.board_title  AS board_title,
        fp.food_picture AS food_picture,
        m.member_id     AS member_id,
        m.profile_image_url AS profile_image_url, <!-- üëà Ï∂îÍ∞Ä -->
        (fp.likes_no_1 + fp.likes_no_2 + fp.likes_no_3 + fp.likes_no_4) AS total_likes
        FROM food_post AS fp
        INNER JOIN member AS m ON fp.member_no = m.member_no
        WHERE fp.confirmed_yn = 'T'
        ORDER BY total_likes DESC, fp.board_no DESC
        LIMIT #{limit}
    </select>

    <!-- food_post_likes -->
    <select id="selectFoodLikesFromPost"
            resultType="com.eat.today.post.query.dto.FoodPostLikesDTO">
        SELECT
        fp.likes_no_1 AS likesNo1,
        fp.likes_no_2 AS likesNo2,
        fp.likes_no_3 AS likesNo3,
        fp.likes_no_4 AS likesNo4
        FROM food_post fp
        WHERE fp.board_no = #{boardNo}
    </select>

    <!-- ÎåìÍ∏Ä Î™©Î°ù: (ÌïÑÏöî Ïãú ÌîÑÎ°úÌïÑ Ï∂îÍ∞Ä Í∞ÄÎä•) -->
    <select id="selectFoodComments" resultType="com.eat.today.post.query.dto.FoodCommentDTO">
        SELECT
        fc.food_comment_no AS food_comment_no,
        m.member_id        AS member_id,
        fc.fc_content      AS fc_content,
        fc.fc_date         AS fc_date
        /* , m.profile_image_url AS profile_image_url  ‚Üê ÎåìÍ∏ÄÏóêÎèÑ ÌïÑÏöîÌïòÎ©¥ DTO/alias Ï∂îÍ∞Ä */
        FROM food_comment fc
        INNER JOIN member m ON fc.member_no = m.member_no
        WHERE fc.board_no = #{boardNo}
        ORDER BY fc.food_comment_no DESC
    </select>

    <!-- ÎÇ¥Í∞Ä Ïì¥ ÎåìÍ∏Ä(ÌöåÏõêÎ≥Ñ, ÏµúÏã†Ïàú) -->
    <select id="selectMyComments" resultType="com.eat.today.post.query.dto.MyCommentDTO">
        SELECT
        fc.food_comment_no AS food_comment_no,
        m.member_id        AS member_id,
        p.board_title      AS board_title,
        fc.fc_content      AS fc_content,
        fc.fc_date         AS fc_date
        FROM food_comment AS fc
        INNER JOIN member    AS m ON fc.member_no = m.member_no
        INNER JOIN food_post AS p ON fc.board_no = p.board_no
        WHERE fc.member_no = #{memberNo}
        ORDER BY fc.food_comment_no DESC
    </select>

    <!-- Î∂ÅÎßàÌÅ¨ Ìè¥Îçî Î™©Î°ù + Í∞úÏàò -->
    <select id="selectBookmarkFolders" resultType="com.eat.today.post.query.dto.BookmarkFolderDTO">
        SELECT
        f.folder_id   AS folderId,
        f.folder_name AS folderName,
        COUNT(b.board_no) AS itemCount,
        f.created_at  AS createdAt
        FROM bookmark_folder f
        LEFT JOIN bookmark b ON b.folder_id = f.folder_id
        WHERE f.member_no = #{memberNo}
        GROUP BY f.folder_id
        ORDER BY f.created_at DESC
    </select>

    <!-- Ìè¥Îçî ÎÇ¥ Ìï≠Î™© -->
    <select id="selectBookmarksInFolder" resultType="com.eat.today.post.query.dto.BookmarkItemDTO">
        SELECT
        p.board_no     AS boardNo,
        p.board_title  AS title,
        p.board_date   AS boardDate
        FROM bookmark b
        JOIN food_post p ON p.board_no = b.board_no
        WHERE b.folder_id = #{folderId}
        ORDER BY p.board_date DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

</mapper>
